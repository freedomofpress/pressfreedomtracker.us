machine:
  python:
    version: 3.5.0
  environment:
    DJANGO_ES_HOST: http://localhost:9200
    DATABASE_URL: postgresql://ubuntu:@127.0.0.1:5432/circle_test


dependencies:
  override:
    - pip install --no-deps -r requirements.txt
  post:
    - pip install flake8
    - wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.3.2.tar.gz
    - tar -xvf elasticsearch-5.3.2.tar.gz
    - elasticsearch-5.3.2/bin/elasticsearch: {background: true}
    - sleep 10 && curl --retry 10 --retry-delay 5 -v $DJANGO_ES_HOST

database:
  post:
    - ./manage.py migrate

test:
  pre:
    - flake8
    - npm install
    - npm run start:
        background: true
  override:
    - ./manage.py test --noinput --keepdb
