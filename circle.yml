machine:
  python:
    version: 3.5.0


dependencies:
  override:
    - pip install --no-deps -r requirements.txt
  post:
    - pip install flake8
    - wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.3.2.tar.gz
    - tar -xvf elasticsearch-5.3.2.tar.gz
    - elasticsearch-5.3.2/bin/elasticsearch: {background: true}
    - sleep 10 && curl --retry 10 --retry-delay 5 -v http://127.0.0.1:9200/
    - wget https://github.com/mozilla/geckodriver/releases/download/v0.14.0/geckodriver-v0.14.0-linux64.tar.gz
    - tar -xzf geckodriver-v0.14.0-linux64.tar.gz -C /home/ubuntu/bin

database:
  post:
    - ./manage.py migrate

test:
  pre:
    - flake8
    - npm install
    - npm run start:
        background: true
  override:
    - ./manage.py test --noinput --keepdb
