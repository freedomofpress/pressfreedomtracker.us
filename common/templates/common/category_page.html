{% extends layout_template %}

{% load common_tags wagtailcore_tags render_as_template %}

{% block flex_class %}
	flex-container--grow-3
{% endblock %}

{% block top_sidebar_class %}
{{ block.super }}
	layout-right-sidebar__sidebar--light
{% endblock%}

{% block secondary-header %}
<div class="layout-right-sidebar">
	<div class="
		layout-right-sidebar__main
		layout-right-sidebar__main--dark
		layout-right-sidebar__main--{{ page.page_color }}
	">
			<div class="category">
				<h3 class="category__name">
					{{ page.title }}
				</h3>
				{% if page.quick_facts.all %}
					<ul class="quickfacts">
						{% for fact in page.quick_facts.all %}
							{% if fact.link_url %}
								<li class="quickfacts__item">
									<a class="quickfacts__link" href="{{ fact.link_url }}">{{ fact.body|richtext_inline }}</a></li>
								</li>
							{% else %}
								<li class="quickfacts__item">
									{{ fact.body|richtext_inline }}
								</li>
							{% endif %}
						{% endfor %}
					</ul>
				{% endif %}
			</div>
	</div>
	<div class="
		layout-right-sidebar__sidebar
		layout-right-sidebar__sidebar--dark
		layout-right-sidebar__sidebar--{{ page.page_color }}
	">
		<table class="data-table data-table--category">
			<h4 class="section-heading section-heading--light section-heading--margin-top">
			Data Summary
		</h4>
			<tr class="data-table__row data-table__row--light">
				<th class="data-table__label data-table__label--light">
					Total cases
				</th>
				<td class="data-table__value">{{ page.incidents.all.count }}</td>
			</tr>
		</table>
	</div>
</div>
{% endblock %}

{% block main_class %}
	layout-right-sidebar__main--padded
{% endblock %}

{% block main %}
	{% include "incident/_filters.html" with no_category_filtering=True category=page.id %}

	{% block ajax %}
		<div class="grid-50 js-infinite-scrolling-parent">
			{% for incident in entries_page %}
				<div class="grid-50__item js-infinite-scrolling-item">
					{% include "incident/_incident.html" with incident=incident teaser=True %}
				</div>
			{% empty %}
				<p class="grid-50__item">There are no incidents in this category yet.</p>
			{% endfor %}
		</div>

		{% if entries_page.has_next %}
			<a
				href="?{% query_transform request page=entries_page.next_page_number %}"
				class="button button--outline button--center js-infinite-scrolling-next-link"
			>
				More Incidents
			</a>
		{% endif %}
	{% endblock %}
{% endblock %}


{% block sidebar_class %}
	layout-right-sidebar__sidebar--light
	layout-right-sidebar__sidebar--padded
{% endblock %}

{% block sidebar %}
		{% if page.methodology %}
			<h4 class="section-heading">
				How we track
					{% if page.plural_name %}
						{{ page.plural_name|title }}
					{% else %}
						{{ page.title|title }}
					{% endif %}
			</h4>
			<div>
				{% with method=page.methodology|richtext %}
					{% render_as_template method %}
				{% endwith %}
			</div>
		{% endif %}
{% endblock %}
