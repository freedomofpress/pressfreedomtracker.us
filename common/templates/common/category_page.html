{% extends layout_template %}

{% load wagtailcore_tags %}
{% load common_tags %}

{% block flex_class %}
    flex-container--grow-3
{% endblock %}

{% block top_sidebar_class %}
    {{ block.super }}
    layout-right-sidebar__sidebar--light
{% endblock%}

{% block secondary-header %}
<div class="layout-right-sidebar">
    <div class="layout-right-sidebar__main
							layout-right-sidebar__main--dark
							layout-right-sidebar__main--{{ page.title|slugify }}"
	>
			<div class="category">
				<h3 class="category__name">
					{{ page.title }}
				</h3>
				<div class="category__description">
					{{ page.description|richtext }}
				</div>
			</div>
	</div>
	<div class="layout-right-sidebar__sidebar
							layout-right-sidebar__sidebar--dark
							layout-right-sidebar__sidebar--{{ page.title|slugify }}"
	>
			{% if page.quick_facts.all %}
			<div class="quickfacts">
					<h4 class="section-heading">Quickfacts</h4>
					<ul class="quickfacts__list">
						{% for fact in page.quick_facts.all %}
							<li class="quickfacts__item">
								{{ fact.body|richtext }}
							</li>
						{% endfor %}
					</ul>
			</div>
			{% endif %}
	</div>
</div>
{% endblock %}

{% block main_class %}
	layout-right-sidebar__main--padded
{% endblock %}

{% block main %}
	{% include "incident/_filters.html" with no_category_filtering=True category=page.id %}

	{% block ajax %}
		<div class="grid-50 js-infinite-scrolling-parent">
			{% for incident in entries_page %}
				<div class="grid-50__item js-infinite-scrolling-item">
					{% include "incident/_incident.html" with incident=incident teaser=True %}
				</div>
			{% empty %}
				<p class="grid-50__item">There are no incidents in this category yet.</p>
			{% endfor %}
		</div>

		{% if entries_page.has_next %}
			<a
				href="?{% query_transform request page=entries_page.next_page_number %}"
				class="button button--outline button--center js-infinite-scrolling-next-link"
			>
				More Incidents
			</a>
		{% endif %}
	{% endblock %}
{% endblock %}


{% block sidebar_class %}
	layout-right-sidebar__sidebar--light
	layout-right-sidebar__sidebar--padded
{% endblock %}

{% block sidebar %}
		<h4 class="section-heading">
			Data Summary
		</h4>
		<table class="data-table">
			<tr class='data-table__row'>
				<th class="data-table__label">
					Total cases
				</th>
				<td class="data-table__value">{{ page.incidents.all.count }}</td>
			</tr>
			<tr class='data-table__row'>
				<th class="data-table__label">
					Cases in 2019
				</th>
				<td class="data-table__value">33</td>
			</tr>
		</table>
		{% if page.methodology %}
			<h4 class="section-heading">
				How we track
					{% if page.plural_name %}
						{{ page.plural_name|title }}
					{% else %}
						{{ page.title|title }}
					{% endif %}
			</h4>
			<div>
				{{ page.methodology|richtext }}
			</div>
		{% endif %}
{% endblock %}
