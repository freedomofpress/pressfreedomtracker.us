{% extends "base.html" %}
{% load wagtailcore_tags %}

{% block maincontainer %}
<main>
	{% include 'incident/_incident.html' with incident=page only %}
	{% if page.related_incidents.all %}
		<h3 class="section-heading">Related Cases</h3>
		<div class="incident-grid">
			{% for related_case in page.related_incidents.all|slice:":2" %}
				<div class="incident-grid__item">
					{% include "incident/_incident.html" with incident=related_case teaser=True only %}
				</div>
			{% endfor %}
		</div>
		<a href="#" class="button button--outline button--center">
			More related cases
		</a>
	{% endif %}
</main>
{% endblock %}

{% block sidebar %}
<aside>
	<table class='data-table'>
		<tbody>
			<tr class='data-table__row'>
				<th class="data-table__label">
					Date of Incident
				</th>
				<td class="data-table__value">{{page.date|date:"F j, Y" }}</td>
			</tr>
			{% if page.journalists.all %}
				<tr class='data-table__row'>
					<th class="data-table__label">
						Journalists
					</th>
					<td class="data-table__value">
						{% with page.journalists.all as journalists %}
							{% for journalistPage in journalists %}
								{% if not forloop.last %}
									{{journalistPage.title}},
								{% else %}
									{{journalistPage.title}}
								{% endif %}
							{% endfor %}
						{% endwith %}
					</td>
				</tr>
			{% endif %}
			<tr class='data-table__row'>
				<th class="data-table__label">
					Last Updated
				</th>
				<td class="data-table__value">
					{% if page.updates.all %}
						{{ page.updates.first.date|date:"F j, Y" }}
					{% else %}
						{{page.first_published_at|date:"F j, Y" }}
					{% endif %}
				</td>
			</tr>
			{% if page.get_related_incidents %}
				<tr class='data-table__row'>
					<th class="data-table__label">
						Related cases
					</th>
						<td class="data-table__value">
							{% for related_case in page.get_related_incidents %}
								<a href="{{related_case.url}}">{{related_case.title}}</a>
							{% endfor %}
						</td>
				</tr>
			{% endif %}
			{% if page.tags.all %}
				<tr class='data-table__row'>
					<th class="data-table__label">
						Tags
					</th>
					<td class="data-table__value">
						{% for tag in page.tags.all %}
							<a href="#">{{tag.name}}</a>
						{% endfor %}
					</td>
				</tr>
			{% endif %}
		</tbody>
	</table>

	{% with page.get_main_category as main_category %}
		  <div>
			  <h3 class="section-heading"
			  >
			  How we track {{main_category|title}}s
			  </h3>
			  <p>{{main_category.methodology|richtext}}</p>
		  </div>
		  <h3 class="section-heading"
			  >
			  <a href="{% pageurl main_category %}" >
				More {{main_category.title}}s &gt;
			  </a>
		  </h3>
	{% endwith %}
</aside>
{% endblock %}
