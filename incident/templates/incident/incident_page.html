{% extends "base.html" %}
{% load wagtailcore_tags %}

{% block maincontainer %}
<main>
	{% include 'incident/_incident.html' with incident=page only %}
	{% if page.related_incidents.all %}
		<h3 class="section-heading">Related Cases</h3>
		<div class="incident-grid">
			{% for related_case in page.related_incidents.all|slice:":2" %}
				<div class="incident-grid__item">
					{% include "incident/_incident.html" with incident=related_case teaser=True only %}
				</div>
			{% endfor %}
		</div>
		<a href="#" class="button button--outline button--center">
			More related cases
		</a>
	{% endif %}
</main>
{% endblock %}

{% block sidebar %}
<aside>
	<table class='data-table'>
		<tbody>
			<tr class='data-table__row'>
				<th class="data-table__label">
					Date of Incident
				</th>
				<td class="data-table__value">{{page.date|date:"F j, Y" }}</td>
			</tr>

			{% if page.targets.all %}
				<tr class='data-table__row'>
					<th class="data-table__label">
						Journalists
					</th>
					<td class="data-table__value">
						{% with page.targets.all as journalists %}
							<ul class="data-table__list">
								{% for journalist in journalists %}
									<li class="data-table__list-item data-table__list-item--inline">
										{{ journalist.name }}</li>
								{% endfor %}
							</ul>
						{% endwith %}
					</td>
				</tr>
			{% endif %}

			{% if page.affiliation %}
				<tr class='data-table__row'>
					<th class="data-table__label">
						Affiliation
					</th>
					<td class="data-table__value">
						{{ page.affiliation }}
					</td>
				</tr>
			{% endif %}

			{% if page.city or page.state %}
				<tr class='data-table__row'>
					<th class="data-table__label">
						Location
					</th>
					<td class="data-table__value">
						{{ page.city|default:"" }} {{ page.state|default:"" }}
					</td>
				</tr>
			{% endif %}

			{% with page.last_updated as last_updated %}
				{% if last_updated %}
				<tr class='data-table__row'>
					<th class="data-table__label">
						Last Updated
					</th>
					<td class="data-table__value">
						{{ last_updated|date:"F j, Y" }}
					</td>
				</tr>
				{% endif %}
			{% endwith %}

			{% if page.get_related_incidents %}
				<tr class='data-table__row'>
					<th class="data-table__label">
						Related cases
					</th>
						<td class="data-table__value">
							<ul class="data-table__list">
								{% for related_case in page.get_related_incidents %}
									<li class="data-table__list-item">
										<a href="{{ related_case.url }}">{{ related_case.title }}</a>
									</li>
								{% endfor %}
							</ul>
						</td>
				</tr>
			{% endif %}

			{% if page.tags.all %}
				<tr class='data-table__row'>
					<th class="data-table__label">
						Tags
					</th>
					<td class="data-table__value">
						<ul class="data-table__list">
							{% for tag in page.tags.all %}
								<li class="data-table__list-item data-table__list-item--inline">
									<a href="#">{{ tag.name }}</a></li>
							{% endfor %}
						</ul>
					</td>
				</tr>
			{% endif %}

			{% include 'incident/_arrest_rows.html' %}
			{% include 'incident/_equipment_rows.html' %}
			{% include 'incident/_lawsuit_rows.html' %}
			{% include 'incident/_border_stop_rows.html' %}
			{% include 'incident/_physical_assault_rows.html' %}
			{% include 'incident/_leak_prosecution_rows.html' %}
			{% include 'incident/_subpeona_rows.html' %}
			{% include 'incident/_legal_order_rows.html' %}
			{% include 'incident/_prior_restraint_rows.html' %}
			{% include 'incident/_denial_of_access_rows.html' %}
		</tbody>
	</table>

	{% with main_category=page.get_main_category %}
		<div>
			<h3 class="section-heading">
				How we track
				{% if main_category.plural_name %}
					{{ main_category.plural_name|title }}
				{% else %}
					{{ main_category|title }}
				{% endif %}
			</h3>
			<p>{{main_category.methodology|richtext}}</p>
		</div>
		<h3 class="section-heading">
			<a href="{% pageurl main_category %}" >
				More
				{% if main_category.plural_name %}
					{{ main_category.plural_name|title }}
				{% else %}
					{{ main_category|title }}
				{% endif %}
				&gt;
			</a>
		</h3>
	{% endwith %}
</aside>
{% endblock %}
